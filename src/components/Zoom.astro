<!-- https://rudnam.com/posts/simple-image-zoom/ -->
<div class="zoom-overlay"><img class="zoomed-img" /></div>
<style>
  .zoom-overlay {
    opacity: 0;
    pointer-events: none;
    z-index: 1000;
    background: 0 0;
    justify-content: center;
    align-items: center;
    display: flex;
    position: fixed;
    inset: 0;
  }

  .zoom-overlay img {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    opacity: 0;
    border-radius: var(--custom-radius);
    box-shadow: 0 20px 60px #0006;
  }

  .zoom-overlay.active {
    opacity: 1;
    pointer-events: auto;
  }

  .zoom-overlay.active img {
    cursor: zoom-out;
    opacity: 1;
  }

  .zoomable-img {
    cursor: zoom-in;
    backface-visibility: hidden;
    will-change: transform;
    transition:
      transform 0.2s,
      opacity 0.15s;
  }
</style>
<script>
  function g() {
    return window.matchMedia("(pointer: fine)").matches;
  }
  function h(n) {
    const e = n.getBoundingClientRect(),
      t = window.innerWidth,
      s = window.innerHeight,
      o = t / 2,
      i = s / 2,
      c = e.left + e.width / 2,
      r = e.top + e.height / 2,
      l = o - c,
      d = i - r,
      y = t * 0.95,
      u = s * 0.95,
      m = y / e.width,
      f = u / e.height,
      p = Math.min(m, f, 3);
    return {
      translateX: l,
      translateY: d,
      scale: p,
      originRect: e,
    };
  }
  function w(n, e) {
    const t = n.querySelector("img"),
      s = h(e);
    ((n._originalImg = e),
      (n._originalRect = s.originRect),
      (t.src = e.currentSrc || e.src),
      (t.alt = e.alt || ""));
    const o = s.originRect;
    ((t.style.position = "fixed"),
      (t.style.left = o.left + "px"),
      (t.style.top = o.top + "px"),
      (t.style.width = o.width + "px"),
      (t.style.height = o.height + "px"),
      (t.style.maxWidth = "none"),
      (t.style.maxHeight = "none"),
      (t.style.transform = "none"),
      (t.style.transition = "none"),
      (t.style.transformOrigin = "center center"),
      (t.style.opacity = "1"),
      (e.style.opacity = "0"),
      (e.style.transition = "opacity 0.15s ease"),
      n.classList.add("active"),
      (n.style.background = "transparent"),
      t.offsetHeight,
      (t.style.transition = "transform 0.4s cubic-bezier(0.2, 0, 0.2, 1)"),
      (t.style.transform = `translate(${s.translateX}px, ${s.translateY}px) scale(${s.scale})`),
      setTimeout(() => {
        ((n.style.transition = "background 0.25s ease"),
          (n.style.background = "rgba(0, 0, 0, 0.8)"));
      }, 100));
  }
  function a(n, e = null) {
    const t = n.querySelector("img");
    if (
      (e || (e = document.querySelector(".zoomable-img[style*='opacity: 0']")),
      (n.style.transition = "background 0.2s ease"),
      (n.style.background = "transparent"),
      e)
    ) {
      const s = e.getBoundingClientRect(),
        o = n._originalRect;
      if (o) {
        const i = s.left - o.left,
          c = s.top - o.top,
          r = s.width / o.width;
        ((t.style.transition = "transform 0.3s cubic-bezier(0.2, 0, 0.2, 1)"),
          (t.style.transform = `translate(${i}px, ${c}px) scale(${r})`));
      } else
        ((t.style.transition = "transform 0.3s cubic-bezier(0.2, 0, 0.2, 1)"),
          (t.style.transform = "translate3d(0, 0, 0) scale(1)"));
    } else
      ((t.style.transition = "transform 0.3s cubic-bezier(0.2, 0, 0.2, 1)"),
        (t.style.transform = "translate3d(0, 0, 0) scale(1)"));
    (setTimeout(() => {
      e && (e.style.opacity = "1");
    }, 150),
      setTimeout(() => {
        (n.classList.remove("active"),
          (n.style.transition = ""),
          (n.style.background = ""),
          (n._originalImg = null),
          (n._originalRect = null),
          (t.style.position = ""),
          (t.style.left = ""),
          (t.style.top = ""),
          (t.style.width = ""),
          (t.style.height = ""),
          (t.style.maxWidth = ""),
          (t.style.maxHeight = ""),
          (t.style.opacity = ""),
          (t.style.willChange = ""),
          (t.style.backfaceVisibility = ""),
          (t.style.transform = ""),
          (t.style.transformOrigin = ""),
          (t.style.transition = ""));
      }, 300));
  }
  function b() {
    const n = document.querySelector(".zoom-overlay");
    n && n.classList.contains("active") && a(n);
  }
  document.addEventListener("click", (n) => {
    if (!g()) return;
    const e = document.querySelector(".zoom-overlay"),
      t = n.target.closest(".zoomable-img");
    if (t) {
      w(e, t);
      return;
    }
    e.classList.contains("active") && a(e, e._originalImg);
  });
  document.addEventListener("keydown", (n) => {
    if (n.key === "Escape") {
      const e = document.querySelector(".zoom-overlay");
      e.classList.contains("active") && a(e, e._originalImg);
    }
  });
  window.addEventListener("resize", b);
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".zoomable-img").forEach((n) => {
      const e = new Image();
      ((e.src = n.currentSrc || n.src), e.decode().catch(() => {}));
    });
  });

  document.addEventListener(
    "wheel",
    (e) => {
      const overlay =
        document.querySelector(".zoom-overlay.active") ||
        document.querySelector(".zoom-bg--reveal");
      if (overlay) {
        e.preventDefault();
        overlay.classList.contains("active") &&
          a(overlay, overlay._originalImg);
      }
    },
    { passive: false }
  );
</script>
